<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Horse Registration</title>
    <link rel="stylesheet" href="../styles/styles.css" />

    <script>
        // Dynamically set <base> tag and global BASE_PATH
        (function () {
            const path = window.location.pathname;
            const isGitHubPages = path.includes('/horse-registration/');
            const basePath = isGitHubPages ? '/horse-registration' : '';

            // Add <base> tag for relative assets
            const base = document.createElement('base');
            base.href = basePath + '/';
            document.head.prepend(base);

            // Make it available to module scripts
            window.BASE_PATH = basePath;
        })();
    </script>
</head>

<body>
    <!-- Dynamic navbar -->
    <div id="navbar-placeholder"></div>

    <main>
        <h1>Register a Horse</h1>
        <hr>
        <h3>Please ensure you have all the required information before begining to fill out registration.</h3>
        <p>This includes:</p>
        <p> - Required photos</p>
        <p> - Registration Number</p>
        <p> - Breeder information</p>
        <p> - Microchip Number</p>

        <p>Add cehckbox to confirm all they have all information, when checked all elements are shown?</p>
        <hr>
        <form id="horse-form">

            <h2>Horse Name:</h2>

            <label for="prefix-suffix-type">Prefix or Suffix:</label><br>
            <div class="prefix-suffix-row">
                <select id="prefix-suffix-type" name="prefix-suffix-type" required>
                    <option value="" disabled selected hidden>Prefix/Suffix</option>
                    <option value="Prefix">Prefix</option>
                    <option value="Suffix">Suffix</option>
                </select>

                <input type="text" id="prefix-suffix" name="prefix-suffix" placeholder="Enter Prefix or Suffix"
                    maxlength="30" required>
            </div>
            <p style="margin-top: 0.5em;">Maximum name length is 30 letters including prefix/suffix and spaces.</p>
            <br>


            <label>Horse Name Options:</label><br>
            <input type="text" id="name-option-1" name="name-option-1" placeholder="Name Option 1" maxlength="30"
                required><br>
            <input type="text" id="name-option-2" name="name-option-2" placeholder="Name Option 2" maxlength="30"><br>
            <input type="text" id="name-option-3" name="name-option-3" placeholder="Name Option 3" maxlength="30"><br>


            <hr> <!-- This line separates the sections -->

            <h2>Physical Details:</h2>
            <label>Sex:</label><br>
            <select id="sex" name="sex" required>
                <option value="" disabled selected hidden>Select One</option>
                <option value="Stallion">Stallion</option>
                <option value="Mare">Mare</option>
                <option value="Filly">Filly</option>
                <option value="Gelding">Gelding</option>
                <option value="Colt">Colt</option>
            </select><br>

            <div id="upgrade-section" style="display: none;">
                <label style="display: inline-block;">Upgrade from foal:</label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="upgrade-from-foal" value="Yes" required> Yes
                </label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="upgrade-from-foal" value="No"> No
                </label>
            </div><br>


            <label for="size-class">Horse Type:</label><br>
            <select id="size-class" name="size-class" required>
                <option value="" disabled selected hidden>Miniature/Larger</option>
                <option value="Miniature">Miniature</option>
                <option value="Larger">Larger</option>
            </select><br>

            <div id="height-inches" style="display: none;">
                <label for="height-inches-input">Height (inches):</label><br>
                <input type="number" id="height-inches-input" name="height-inches" min="20" max="50" step="0.5"
                    placeholder="e.g. 34.5"><br><br>
            </div>

            <div id="height-hands" style="display: none;">
                <label for="height-hands-input">Height (hands):</label><br>
                <input type="number" id="height-hands-input" name="height-hands" min="8" max="20" step="0.5"
                    placeholder="e.g. 14.5"><br><br>
            </div>

            <label>Pattern:</label><br>
            <select id="pattern-type" name="pattern-type" required>
                <option value="" disabled selected hidden>Select One</option>
                <option value="Tobiano">Tobiano</option>
                <option value="Overo">Overo</option>
                <option value="Tobero">Tobero</option>
                <option value="Sabino">Sabino</option>
                <option value="Splash">Splash</option>
            </select><br>

            <label>Horse Colour:</label><br>
            <input type="text" id="colour" name="color" placeholder="Colour" maxlength="30" required><br>

            <label for="microchip-number-input">Microchip Number:</label><br>
            <input type="text" id="microchip-number-input" name="microchip-number" placeholder="e.g. xxxx"
                maxlength="30" required><br>

            <label>Brand Description:</label><br>
            <input type="text" id="brand-description" name="brand-description" placeholder="e.g. Symbol, letters"
                maxlength="50"><br>

            <label>Brand Position:</label><br>
            <input type="text" id="brand-position" name="brand-position" placeholder="e.g. Near shoulder"
                maxlength="50"><br>

            <label>Add photo attach thing here</label>
            <br>

            <hr> <!-- This line separates the sections -->
            <h2>Registration Details:</h2>

            <div>
                <label style="display: inline-block;">Registered with another Society:</label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="another-society-recorded" value="Yes" required> Yes
                </label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="another-society-recorded" value="No"> No
                </label>
            </div><br><br>

            <label>Registration Number:</label><br>
            <input type="text" id="registration-number" name="registration-number" placeholder="e.g. xxxx"
                maxlength="50"><br>

            <label>Add photo attach thing here</label>
            <br>

            <hr> <!-- This line separates the sections -->
            <h2>Breeder Details:</h2>

            <label>Bred by:</label><br>
            <input type="text" id="bred-by" name="bred-by" placeholder="e.g. TO BE ADDED" maxlength="50"><br>

            <label>Address for breeder information</label>
            <br>

            <hr> <!-- This line separates the sections -->
            <h2>Other Details:</h2>

            <label>Foaling Date:</label><br>
            <input type="date" id="foaling-date" name="foaling-date" required><br>


            <div>
                <label style="display: inline-block;">Pinto Foal Recorded:</label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="pinto-foal-recorded" value="Yes" required> Yes
                </label>
                <label style="display: inline-block; margin-left: 10px;">
                    <input type="radio" name="pinto-foal-recorded" value="No"> No
                </label>
            </div><br>

            <hr> <!-- This line separates the sections -->
            <h2>Ancestry Details:</h2>

            <label>Sire information</label>
            <br>
            <label>Sires Sire and Dam information</label>
            <br>
            <label>Dam information</label>
            <br>
            <label>Dams Sire and Dam information</label>
            <br><br>





            <button type="submit">Submit Registration</button>
        </form>
    </main>

    <!-- Firebase + Firestore + Form Logic -->
    <script type="module">
        // Toggle upgrade checkbox
        const feeTypeSelect = document.getElementById('sex');
        const upgradeSection = document.getElementById('upgrade-section');

        feeTypeSelect.addEventListener('change', () => {
            upgradeSection.style.display = (feeTypeSelect.value === 'Stallion') ? 'block' : 'none';
        });

        // Toggle height fields
        const sizeClassSelect = document.getElementById('size-class');
        const heightHands = document.getElementById('height-hands');
        const heightInches = document.getElementById('height-inches');

        sizeClassSelect.addEventListener('change', () => {
            const value = sizeClassSelect.value;
            if (value === 'Miniature') {
                heightInches.style.display = 'block';
                heightHands.style.display = 'none';
            } else if (value === 'Larger') {
                heightHands.style.display = 'block';
                heightInches.style.display = 'none';
            } else {
                heightHands.style.display = 'none';
                heightInches.style.display = 'none';
            }
        });

        const [{ app }, { requireVerifiedUser }] = await Promise.all([
            import(`${window.BASE_PATH}/scripts/firebase-init.js`),
            import(`${window.BASE_PATH}/scripts/check-user.js`),
        ]);

        import {
            getFirestore,
            collection,
            addDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

        const db = getFirestore(app);
        const user = await requireVerifiedUser();

        document.getElementById("horse-form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const horseData = {
                horseName: document.getElementById("horseName").value,
                breed: document.getElementById("breed").value,
                color: document.getElementById("color").value,
                dob: document.getElementById("dob").value,
                sex: document.getElementById("sex").value,
                createdAt: serverTimestamp(),
                submittedBy: user.uid,
                submittedByEmail: user.email
            };
            try {
                await addDoc(collection(db, "horses"), horseData);
                document.getElementById("form-message").textContent = "Registration successful!";
                e.target.reset();
            } catch (error) {
                document.getElementById("form-message").textContent = "Error: " + error.message;
            }


        });
    </script>


    <!-- Load Navbar -->
    <script type="module">
        import(`${window.BASE_PATH}/scripts/load-navbar.js`).then(mod => mod.loadNavbar());
    </script>

</body>

</html>